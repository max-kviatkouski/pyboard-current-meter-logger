#!/usr/bin/env python3
import json
#sample request
#https://tidesandcurrents.noaa.gov/api/datagetter?product=predictions&begin_date=20181224&end_date=20190113&datum=MLLW&station=9447814&time_zone=lst_ldt&units=english&interval=hilo&format=json&application=NOS.COOPS.TAC.TidePred


str = '{ "predictions" : [{"t":"2019-05-17 03:58", "v":"11.475", "type":"H"},{"t":"2019-05-17 10:42", "v":"-0.797", "type":"L"},{"t":"2019-05-17 17:32", "v":"10.320", "type":"H"},{"t":"2019-05-17 22:52", "v":"4.548", "type":"L"},{"t":"2019-05-18 04:32", "v":"11.317", "type":"H"},{"t":"2019-05-18 11:20", "v":"-1.654", "type":"L"},{"t":"2019-05-18 18:24", "v":"10.853", "type":"H"},{"t":"2019-05-18 23:43", "v":"5.335", "type":"L"},{"t":"2019-05-19 05:07", "v":"11.007", "type":"H"},{"t":"2019-05-19 11:57", "v":"-2.138", "type":"L"},{"t":"2019-05-19 19:14", "v":"11.205", "type":"H"},{"t":"2019-05-20 00:34", "v":"5.990", "type":"L"},{"t":"2019-05-20 05:43", "v":"10.554", "type":"H"},{"t":"2019-05-20 12:36", "v":"-2.254", "type":"L"},{"t":"2019-05-20 20:01", "v":"11.375", "type":"H"},{"t":"2019-05-21 01:26", "v":"6.472", "type":"L"},{"t":"2019-05-21 06:21", "v":"9.987", "type":"H"},{"t":"2019-05-21 13:15", "v":"-2.040", "type":"L"},{"t":"2019-05-21 20:47", "v":"11.382", "type":"H"},{"t":"2019-05-22 02:21", "v":"6.758", "type":"L"},{"t":"2019-05-22 07:01", "v":"9.338", "type":"H"},{"t":"2019-05-22 13:56", "v":"-1.555", "type":"L"},{"t":"2019-05-22 21:33", "v":"11.262", "type":"H"},{"t":"2019-05-23 03:20", "v":"6.842", "type":"L"},{"t":"2019-05-23 07:47", "v":"8.644", "type":"H"},{"t":"2019-05-23 14:39", "v":"-0.860", "type":"L"},{"t":"2019-05-23 22:20", "v":"11.063", "type":"H"},{"t":"2019-05-24 04:29", "v":"6.703", "type":"L"},{"t":"2019-05-24 08:39", "v":"7.940", "type":"H"},{"t":"2019-05-24 15:24", "v":"-0.016", "type":"L"},{"t":"2019-05-24 23:08", "v":"10.848", "type":"H"},{"t":"2019-05-25 05:46", "v":"6.296", "type":"L"},{"t":"2019-05-25 09:43", "v":"7.292", "type":"H"},{"t":"2019-05-25 16:14", "v":"0.916", "type":"L"},{"t":"2019-05-25 23:56", "v":"10.669", "type":"H"},{"t":"2019-05-26 06:57", "v":"5.621", "type":"L"},{"t":"2019-05-26 11:00", "v":"6.824", "type":"H"},{"t":"2019-05-26 17:09", "v":"1.870", "type":"L"},{"t":"2019-05-27 00:41", "v":"10.559", "type":"H"},{"t":"2019-05-27 07:49", "v":"4.765", "type":"L"},{"t":"2019-05-27 12:24", "v":"6.691", "type":"H"},{"t":"2019-05-27 18:09", "v":"2.781", "type":"L"},{"t":"2019-05-28 01:23", "v":"10.518", "type":"H"},{"t":"2019-05-28 08:28", "v":"3.803", "type":"L"},{"t":"2019-05-28 13:47", "v":"6.965", "type":"H"},{"t":"2019-05-28 19:10", "v":"3.602", "type":"L"},{"t":"2019-05-29 01:59", "v":"10.521", "type":"H"},{"t":"2019-05-29 08:58", "v":"2.768", "type":"L"},{"t":"2019-05-29 15:00", "v":"7.559", "type":"H"},{"t":"2019-05-29 20:10", "v":"4.328", "type":"L"},{"t":"2019-05-30 02:32", "v":"10.545", "type":"H"},{"t":"2019-05-30 09:26", "v":"1.681", "type":"L"},{"t":"2019-05-30 16:00", "v":"8.319", "type":"H"},{"t":"2019-05-30 21:04", "v":"4.988", "type":"L"},{"t":"2019-05-31 03:02", "v":"10.570", "type":"H"},{"t":"2019-05-31 09:54", "v":"0.571", "type":"L"},{"t":"2019-05-31 16:50", "v":"9.113", "type":"H"},{"t":"2019-05-31 21:53", "v":"5.592", "type":"L"},{"t":"2019-06-01 03:32", "v":"10.586", "type":"H"},{"t":"2019-06-01 10:24", "v":"-0.507", "type":"L"},{"t":"2019-06-01 17:35", "v":"9.865", "type":"H"},{"t":"2019-06-01 22:40", "v":"6.132", "type":"L"},{"t":"2019-06-02 04:02", "v":"10.584", "type":"H"},{"t":"2019-06-02 10:57", "v":"-1.480", "type":"L"},{"t":"2019-06-02 18:17", "v":"10.521", "type":"H"},{"t":"2019-06-02 23:25", "v":"6.584", "type":"L"},{"t":"2019-06-03 04:34", "v":"10.549", "type":"H"},{"t":"2019-06-03 11:34", "v":"-2.270", "type":"L"},{"t":"2019-06-03 19:00", "v":"11.044", "type":"H"},{"t":"2019-06-04 00:12", "v":"6.921", "type":"L"},{"t":"2019-06-04 05:10", "v":"10.459", "type":"H"},{"t":"2019-06-04 12:14", "v":"-2.802", "type":"L"},{"t":"2019-06-04 19:44", "v":"11.415", "type":"H"},{"t":"2019-06-05 01:01", "v":"7.116", "type":"L"},{"t":"2019-06-05 05:50", "v":"10.273", "type":"H"},{"t":"2019-06-05 12:58", "v":"-3.014", "type":"L"},{"t":"2019-06-05 20:30", "v":"11.631", "type":"H"},{"t":"2019-06-06 01:53", "v":"7.144", "type":"L"},{"t":"2019-06-06 06:35", "v":"9.953", "type":"H"},{"t":"2019-06-06 13:44", "v":"-2.864", "type":"L"},{"t":"2019-06-06 21:18", "v":"11.717", "type":"H"},{"t":"2019-06-07 02:50", "v":"6.972", "type":"L"},{"t":"2019-06-07 07:29", "v":"9.466", "type":"H"},{"t":"2019-06-07 14:33", "v":"-2.334", "type":"L"},{"t":"2019-06-07 22:07", "v":"11.717", "type":"H"},{"t":"2019-06-08 03:54", "v":"6.546", "type":"L"},{"t":"2019-06-08 08:32", "v":"8.825", "type":"H"},{"t":"2019-06-08 15:25", "v":"-1.438", "type":"L"},{"t":"2019-06-08 22:57", "v":"11.679", "type":"H"},{"t":"2019-06-09 05:04", "v":"5.794", "type":"L"},{"t":"2019-06-09 09:47", "v":"8.137", "type":"H"},{"t":"2019-06-09 16:21", "v":"-0.238", "type":"L"},{"t":"2019-06-09 23:47", "v":"11.643", "type":"H"},{"t":"2019-06-10 06:15", "v":"4.682", "type":"L"},{"t":"2019-06-10 11:14", "v":"7.626", "type":"H"},{"t":"2019-06-10 17:21", "v":"1.152", "type":"L"},{"t":"2019-06-11 00:35", "v":"11.621", "type":"H"},{"t":"2019-06-11 07:18", "v":"3.287", "type":"L"},{"t":"2019-06-11 12:49", "v":"7.553", "type":"H"},{"t":"2019-06-11 18:27", "v":"2.573", "type":"L"}]}'
j = json.loads(str)
# for p in j['predictions']:
#     print("{},,{}".format(p['t'], p['v']))

s = -1
e = -1
predictions = j['predictions']
for i, p in enumerate(predictions[:-1]):
    t1 = predictions[i]['t'].split(' ')[0]
    t2 = predictions[i+1]['t'].split(' ')[0]
    if t2 != t1:
        s = e-2
        e = i+2
        if s > 0:
            with open('{}.tides.csv'.format(t1), 'w+') as f:
                lines = ["{},,{}".format(pred['t'], pred['v']) for pred in predictions[s:e]]
                f.writelines('\n'.join(lines))