#!/usr/bin/env python3
import json
#sample request
#https://tidesandcurrents.noaa.gov/api/datagetter?product=predictions&begin_date=20181224&end_date=20190113&datum=MLLW&station=9447814&time_zone=lst_ldt&units=english&interval=hilo&format=json&application=NOS.COOPS.TAC.TidePred


str = '{ "predictions" : [{"t":"2018-12-23 05:58", "v":"12.122", "type":"H"},{"t":"2018-12-23 11:14", "v":"7.299", "type":"L"},{"t":"2018-12-23 16:12", "v":"11.337", "type":"H"},{"t":"2018-12-23 23:15", "v":"-3.161", "type":"L"},{"t":"2018-12-24 06:42", "v":"12.435", "type":"H"},{"t":"2018-12-24 12:06", "v":"7.125", "type":"L"},{"t":"2018-12-24 17:01", "v":"11.049", "type":"H"},{"t":"2018-12-25 00:01", "v":"-2.974", "type":"L"},{"t":"2018-12-25 07:27", "v":"12.589", "type":"H"},{"t":"2018-12-25 13:01", "v":"6.780", "type":"L"},{"t":"2018-12-25 17:56", "v":"10.551", "type":"H"},{"t":"2018-12-26 00:49", "v":"-2.332", "type":"L"},{"t":"2018-12-26 08:13", "v":"12.614", "type":"H"},{"t":"2018-12-26 14:00", "v":"6.255", "type":"L"},{"t":"2018-12-26 18:56", "v":"9.855", "type":"H"},{"t":"2018-12-27 01:39", "v":"-1.255", "type":"L"},{"t":"2018-12-27 09:00", "v":"12.543", "type":"H"},{"t":"2018-12-27 15:04", "v":"5.535", "type":"L"},{"t":"2018-12-27 20:06", "v":"9.048", "type":"H"},{"t":"2018-12-28 02:31", "v":"0.184", "type":"L"},{"t":"2018-12-28 09:47", "v":"12.401", "type":"H"},{"t":"2018-12-28 16:12", "v":"4.602", "type":"L"},{"t":"2018-12-28 21:26", "v":"8.321", "type":"H"},{"t":"2018-12-29 03:27", "v":"1.857", "type":"L"},{"t":"2018-12-29 10:35", "v":"12.210", "type":"H"},{"t":"2018-12-29 17:20", "v":"3.471", "type":"L"},{"t":"2018-12-29 23:01", "v":"7.963", "type":"H"},{"t":"2018-12-30 04:30", "v":"3.572", "type":"L"},{"t":"2018-12-30 11:22", "v":"11.984", "type":"H"},{"t":"2018-12-30 18:23", "v":"2.245", "type":"L"},{"t":"2018-12-31 00:47", "v":"8.244", "type":"H"},{"t":"2018-12-31 05:44", "v":"5.086", "type":"L"},{"t":"2018-12-31 12:09", "v":"11.731", "type":"H"},{"t":"2018-12-31 19:18", "v":"1.070", "type":"L"},{"t":"2019-01-01 02:21", "v":"9.022", "type":"H"},{"t":"2019-01-01 07:00", "v":"6.187", "type":"L"},{"t":"2019-01-01 12:54", "v":"11.533", "type":"H"},{"t":"2019-01-01 20:03", "v":"0.058", "type":"L"},{"t":"2019-01-02 03:32", "v":"10.018", "type":"H"},{"t":"2019-01-02 08:15", "v":"6.927", "type":"L"},{"t":"2019-01-02 13:36", "v":"11.226", "type":"H"},{"t":"2019-01-02 20:44", "v":"-0.676", "type":"L"},{"t":"2019-01-03 04:27", "v":"10.849", "type":"H"},{"t":"2019-01-03 09:19", "v":"7.320", "type":"L"},{"t":"2019-01-03 14:16", "v":"10.906", "type":"H"},{"t":"2019-01-03 21:21", "v":"-1.132", "type":"L"},{"t":"2019-01-04 05:11", "v":"11.407", "type":"H"},{"t":"2019-01-04 10:13", "v":"7.492", "type":"L"},{"t":"2019-01-04 14:55", "v":"10.590", "type":"H"},{"t":"2019-01-04 21:56", "v":"-1.349", "type":"L"},{"t":"2019-01-05 05:47", "v":"11.704", "type":"H"},{"t":"2019-01-05 10:59", "v":"7.522", "type":"L"},{"t":"2019-01-05 15:33", "v":"10.292", "type":"H"},{"t":"2019-01-05 22:31", "v":"-1.383", "type":"L"},{"t":"2019-01-06 06:18", "v":"11.816", "type":"H"},{"t":"2019-01-06 11:40", "v":"7.446", "type":"L"},{"t":"2019-01-06 16:11", "v":"10.007", "type":"H"},{"t":"2019-01-06 23:05", "v":"-1.268", "type":"L"},{"t":"2019-01-07 06:46", "v":"11.832", "type":"H"},{"t":"2019-01-07 12:17", "v":"7.274", "type":"L"},{"t":"2019-01-07 16:50", "v":"9.720", "type":"H"},{"t":"2019-01-07 23:41", "v":"-1.015", "type":"L"},{"t":"2019-01-08 07:12", "v":"11.820", "type":"H"},{"t":"2019-01-08 12:54", "v":"7.006", "type":"L"},{"t":"2019-01-08 17:32", "v":"9.400", "type":"H"},{"t":"2019-01-09 00:17", "v":"-0.603", "type":"L"},{"t":"2019-01-09 07:40", "v":"11.805", "type":"H"},{"t":"2019-01-09 13:31", "v":"6.647", "type":"L"},{"t":"2019-01-09 18:15", "v":"9.023", "type":"H"},{"t":"2019-01-10 00:54", "v":"0.000", "type":"L"},{"t":"2019-01-10 08:11", "v":"11.776", "type":"H"},{"t":"2019-01-10 14:12", "v":"6.190", "type":"L"},{"t":"2019-01-10 19:03", "v":"8.580", "type":"H"},{"t":"2019-01-11 01:32", "v":"0.828", "type":"L"},{"t":"2019-01-11 08:45", "v":"11.711", "type":"H"},{"t":"2019-01-11 14:57", "v":"5.626", "type":"L"},{"t":"2019-01-11 19:57", "v":"8.099", "type":"H"},{"t":"2019-01-12 02:11", "v":"1.887", "type":"L"},{"t":"2019-01-12 09:20", "v":"11.595", "type":"H"},{"t":"2019-01-12 15:46", "v":"4.929", "type":"L"},{"t":"2019-01-12 21:02", "v":"7.672", "type":"H"},{"t":"2019-01-13 02:53", "v":"3.145", "type":"L"},{"t":"2019-01-13 09:56", "v":"11.434", "type":"H"},{"t":"2019-01-13 16:37", "v":"4.072", "type":"L"},{"t":"2019-01-13 22:20", "v":"7.462", "type":"H"},{"t":"2019-01-14 03:40", "v":"4.521", "type":"L"},{"t":"2019-01-14 10:34", "v":"11.255", "type":"H"},{"t":"2019-01-14 17:30", "v":"3.044", "type":"L"},{"t":"2019-01-14 23:51", "v":"7.669", "type":"H"}]}'
j = json.loads(str)
# for p in j['predictions']:
#     print("{},,{}".format(p['t'], p['v']))

s = -1
e = -1
predictions = j['predictions']
for i, p in enumerate(predictions[:-1]):
    t1 = predictions[i]['t'].split(' ')[0]
    t2 = predictions[i+1]['t'].split(' ')[0]
    if t2 != t1:
        s = e-2
        e = i+2
        if s > 0:
            with open('{}.tides.csv'.format(t1), 'w+') as f:
                lines = ["{},,{}".format(pred['t'], pred['v']) for pred in predictions[s:e]]
                f.writelines('\n'.join(lines))